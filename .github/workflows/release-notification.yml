name: Release Notification

on:
  release:
    types: [published]

jobs:
  notify:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      issues: write
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    
    - name: Extract version from tag
      id: version
      run: |
        VERSION="${{ github.event.release.tag_name }}"
        # Remove 'v' prefix if present
        VERSION=${VERSION#v}
        echo "version=$VERSION" >> $GITHUB_OUTPUT
        echo "Release version: $VERSION"
    
    - name: Create release notification comment
      uses: actions/github-script@v7
      with:
        script: |
          const version = '${{ steps.version.outputs.version }}';
          const releaseUrl = '${{ github.event.release.html_url }}';
          const releaseBody = `${{ github.event.release.body }}`;
          
          const comment = `## üéâ Release ${version} Published
          
          ### ‚úÖ Automated Actions
          
          - ‚úÖ Docker image built and pushed to ghcr.io
          - ‚úÖ MCP Registry publication (if configured)
          
          ### üìã Manual Submissions Required
          
          Please submit this release to community directories using the prepared templates:
          
          | Directory | Template | Status |
          |-----------|----------|--------|
          | [MCPList.ai](https://www.mcplist.ai/) | [MCPLIST_SUBMISSION.md](https://github.com/${{ github.repository }}/blob/main/MCPLIST_SUBMISSION.md) | ‚è≥ Pending |
          | [MCP Index](https://mcpindex.net/) | [MCPINDEX_SUBMISSION.md](https://github.com/${{ github.repository }}/blob/main/MCPINDEX_SUBMISSION.md) | ‚è≥ Pending |
          | [MCPServ.club](https://www.mcpserv.club/) | [MCPSERV_SUBMISSION.md](https://github.com/${{ github.repository }}/blob/main/MCPSERV_SUBMISSION.md) | ‚è≥ Pending |
          | [Directory MCP](https://directorymcp.com/) | [DIRECTORY_MCP_SUBMISSION.md](https://github.com/${{ github.repository }}/blob/main/DIRECTORY_MCP_SUBMISSION.md) | ‚è≥ Pending |
          | [MCPHub](https://mcphub.com/) | [MCPHUB_SUBMISSION.md](https://github.com/${{ github.repository }}/blob/main/MCPHUB_SUBMISSION.md) | ‚è≥ Pending |
          
          ### üì¶ Release Details
          
          - **Version**: ${version}
          - **Release**: ${releaseUrl}
          - **Docker Image**: \`ghcr.io/${{ github.repository }}:${version}\`
          - **Docker Image (latest)**: \`ghcr.io/${{ github.repository }}:latest\`
          
          ### üìù Release Notes
          
          ${releaseBody || 'No release notes provided.'}
          
          ---
          
          *This comment was automatically created by the release-notification workflow.*`;
          
          // Create issue for release notification
          // Note: GitHub Releases don't support comments, so we create an issue instead
          github.rest.issues.create({
            owner: context.repo.owner,
            repo: context.repo.repo,
            title: `üì¢ Release ${version} Published - Manual Submissions Required`,
            body: comment,
            labels: ['release', 'documentation']
          });

